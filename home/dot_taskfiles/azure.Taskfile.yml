# yaml-language-server: $schema=https://taskfile.dev/schema.json
# docs: https://taskfile.dev
---
version: "3"

vars:
  AZURE_VERSION:
    map:
      az: latest
      azd: latest
      bicep: latest

tasks:
  # * Install Azure CLI
  install:az:
    desc: Install Azure CLI
    cmds:
      - task: :internal:_install:winget
        vars:
          APP: Microsoft.AzureCLI
          VERSION: "{{.AZURE_VERSION.az}}"
      - task: :internal:_install:brew
        vars:
          APP: azure-cli@{{.AZURE_VERSION.az}}
      - cmd: |
          sudo ./scripts/install_az.sh "{{.AZURE_VERSION.az}}"
        platforms: [linux]
    dir: "{{.TASKFILE_DIR}}"


  # * Install Azure Developer CLI
  install:azd:
    desc: Install Azure Developer CLI
    cmds:
      - task: :internal:_install:winget
        vars:
          APP: Microsoft.Azd
          VERSION: "{{.AZURE_VERSION.azd}}"
      - task: :internal:_install:brew:tap
        vars:
          APP: azure/azd
      - task: :internal:_install:brew
        vars:
          APP: azd@{{.AZURE_VERSION.azd}}
      - cmd: |
          ./scripts/install_azd.sh "{{.AZURE_VERSION.azd}}"
        platforms: [linux]
    dir: "{{.TASKFILE_DIR}}"

  # * Install Bicep
  install:bicep:
    desc: Install Bicep
    cmds:
      - task: :internal:_install:winget
        vars:
          APP: Microsoft.Bicep
          VERSION: "{{.AZURE_VERSION.bicep}}"
      - task: :internal:_install:brew:tap
        vars:
          APP: azure/bicep
      - task: :internal:_install:brew
        vars:
          APP: bicep@{{.AZURE_VERSION.bicep}}
      - cmd: |
          ./scripts/install_bicep.sh "{{.AZURE_VERSION.bicep}}"
        platforms: [linux]
    dir: "{{.TASKFILE_DIR}}"

  # * Tools
  tools:
    desc: Install Azure tools
    vars:
      ITEMS:
        - az
        - azd
        - bicep
    cmds:
      - for: { var: ITEMS }
        task: install:{{.ITEM}}
