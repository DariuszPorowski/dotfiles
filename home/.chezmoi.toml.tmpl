# ~/.config/chezmoi/config.toml

{{/* GitHub Codespaces clone the repository to this directory */}}
{{- if (env "CODESPACES") }}
sourceDir = "/workspaces/.codespaces/.persistedshare/dotfiles"
{{- end }}

{{/* Ephemeral check - must be inline here since machine.toml.tmpl is included after */}}
{{- $is_ephemeral := or (env "CODESPACES" | not | not) (env "REMOTE_CONTAINERS" | not | not) (env "CI" | not | not) (eq .chezmoi.username "vscode") -}}
{{- if not $is_ephemeral }}
encryption = "age"
[age]
  identity = "~/personal.age"
  recipient = "age1ql3z7hjy54pw3hyww5ayyfg7zqgvc7w3j2elw8zmrj2kg5sfn9aqmcac8p"
{{- end }}

progress = true
verbose = true

{{- includeTemplate "cpu.toml.tmpl" . }}
{{- includeTemplate "machine.toml.tmpl" . }}

[data]
  username = {{ .chezmoi.username | splitList `\` | last | quote }}

[data.github]
  username = {{ env "GITHUB_USER" | default "DariuszPorowski" | quote }}
  workspace = {{ env "GITHUB_WORKSPACE" | not | not }}

[onepassword]
  cache = true

{{ if lookPath "code" }}
[edit]
  command = "code"
  args = ["--wait"]

[diff]
  command = "code"
  args = ["--wait", "--diff"]

[merge]
  command = "code"
  args = ["--wait", "$MERGED"]
{{- end }}

[update]
  recurseSubmodules = true

{{ if lookPath "pwsh" }}
[interpreters.ps1]
  command = "pwsh"
  args = ["-NoLogo", "-NoProfile"]
{{- end }}
