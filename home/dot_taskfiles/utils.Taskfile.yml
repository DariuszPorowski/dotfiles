# yaml-language-server: $schema=https://taskfile.dev/schema.json
# docs: https://taskfile.dev
---
version: "3"

tasks:
  # * Install Dapr
  install:dapr:
    desc: Install Dapr
    cmds:
      - task: :internal:_install:winget
        vars:
          APP: Dapr.CLI
          VERSION: "{{.VERSION.dapr}}"
      - task: :internal:_install:brew
        vars:
          APP: dapr/tap/dapr-cli@{{.VERSION.dapr}}
      - cmd: |
          ./scripts/install_dapr.sh "{{.VERSION.dapr}}"
        platforms: [linux]
    dir: "{{.TASKFILE_DIR}}"

  # * Install ORAS
  install:oras:
    desc: Install ORAS
    cmds:
      - task: :internal:_install:winget
        vars:
          APP: ORASProject.ORAS
          VERSION: "{{.VERSION.oras}}"
      - task: :internal:_install:brew
        vars:
          APP: oras@{{.VERSION.oras}}
      - cmd: |
          ./scripts/install_oras.sh "{{.VERSION.oras}}"
        platforms: [linux]
    dir: "{{.TASKFILE_DIR}}"

  # * Install JQ
  install:jq:
    desc: Install JQ
    cmds:
      - task: :internal:_install:winget
        vars:
          APP: jqlang.jq
          VERSION: "{{.VERSION.jq}}"
      - task: :internal:_install:brew
        vars:
          APP: jq@{{.VERSION.jq}}
      - cmd: |
          echo 1 # TODO
        platforms: [linux]

  # * Install MISE
  install:mise:
    desc: Install MISE
    cmds:
      - task: :internal:_install:winget
        vars:
          APP: jdx.mise
          VERSION: "{{.VERSION.mise}}"
      - task: :internal:_install:brew
        vars:
          APP: mise@{{.VERSION.mise}}
      - cmd: |
          ./scripts/install_mise.sh "{{.VERSION.mise}}"
        platforms: [linux]
    dir: "{{.TASKFILE_DIR}}"

  # * Tools
  tools:
    desc: Install Utils tools
    vars:
      ITEMS:
        - dapr
        - oras
        - jq
        - mise
    cmds:
      - for: { var: ITEMS }
        task: install:{{.ITEM}}
