# yaml-language-server: $schema=https://taskfile.dev/schema.json
# docs: https://taskfile.dev
---
version: "3"

vars:
  UTILS_VERSION:
    map:
      dapr: latest
      oras: latest
      jq: latest
      mise: latest

tasks:
  # * Install Dapr
  install:dapr:
    desc: Install Dapr
    cmds:
      - task: :internal:_install:winget
        vars:
          APP: Dapr.CLI
          VERSION: "{{.UTILS_VERSION.dapr}}"
      - task: :internal:_install:brew
        vars:
          APP: dapr/tap/dapr-cli@{{.UTILS_VERSION.dapr}}
      - cmd: |
          ./scripts/install_dapr.sh "{{.UTILS_VERSION.dapr}}"
        platforms: [linux]
    dir: "{{.TASKFILE_DIR}}"

  # * Install ORAS
  install:oras:
    desc: Install ORAS
    cmds:
      - task: :internal:_install:winget
        vars:
          APP: ORASProject.ORAS
          VERSION: "{{.UTILS_VERSION.oras}}"
      - task: :internal:_install:brew
        vars:
          APP: oras@{{.UTILS_VERSION.oras}}
      - cmd: |
          ./scripts/install_oras.sh "{{.UTILS_VERSION.oras}}"
        platforms: [linux]
    dir: "{{.TASKFILE_DIR}}"

  # * Install JQ
  install:jq:
    desc: Install JQ
    cmds:
      - task: :internal:_install:winget
        vars:
          APP: jqlang.jq
          VERSION: "{{.UTILS_VERSION.jq}}"
      - task: :internal:_install:brew
        vars:
          APP: jq@{{.UTILS_VERSION.jq}}
      - cmd: |
          ./scripts/install_jq.sh "{{.UTILS_VERSION.jq}}"
        platforms: [linux]
    dir: "{{.TASKFILE_DIR}}"

  # * Install MISE
  install:mise:
    desc: Install MISE
    cmds:
      - task: :internal:_install:winget
        vars:
          APP: jdx.mise
          VERSION: "{{.UTILS_VERSION.mise}}"
      - task: :internal:_install:brew
        vars:
          APP: mise@{{.UTILS_VERSION.mise}}
      - cmd: |
          ./scripts/install_mise.sh "{{.UTILS_VERSION.mise}}"
        platforms: [linux]
    dir: "{{.TASKFILE_DIR}}"

  # * Tools
  tools:
    desc: Install Utils tools
    vars:
      ITEMS:
        - dapr
        - oras
        - jq
        - mise
    cmds:
      - for: { var: ITEMS }
        task: install:{{.ITEM}}
