# yaml-language-server: $schema=https://taskfile.dev/schema.json
# docs: https://taskfile.dev
---
version: "3"

vars:
  TERRAFORM_VERSION:
    map:
      terraform: latest
      opentofu: latest

tasks:
  # * Install Terraform
  install:terraform:
    desc: Install Terraform
    cmds:
      - task: :internal:_install:winget
        vars:
          APP: HashiCorp.Terraform
          VERSION: "{{.TERRAFORM_VERSION.terraform}}"
      - task: :internal:_install:brew:tap
        vars:
          APP: hashicorp/tap
      - task: :internal:_install:brew
        vars:
          APP: hashicorp/tap/terraform@{{.TERRAFORM_VERSION.terraform}}
      - cmd: |
          sudo ./scripts/install_terraform.sh "{{.TERRAFORM_VERSION.terraform}}"
        platforms: [linux]
    dir: "{{.TASKFILE_DIR}}"

  # * Install OpenTofu
  install:opentofu:
    desc: Install OpenTofu
    cmds:
      - task: :internal:_install:winget
        vars:
          APP: OpenTofu.Tofu
          VERSION: "{{.TERRAFORM_VERSION.opentofu}}"
      - task: :internal:_install:brew
        vars:
          APP: opentofu@{{.TERRAFORM_VERSION.opentofu}}
      - cmd: |
          ./scripts/install_opentofu.sh "{{.TERRAFORM_VERSION.opentofu}}"
        platforms: [linux]
    dir: "{{.TASKFILE_DIR}}"

  # * Tools
  tools:
    desc: Install Terraform tools
    vars:
      ITEMS:
        - terraform
        - opentofu
    cmds:
      - for: { var: ITEMS }
        task: install:{{.ITEM}}
